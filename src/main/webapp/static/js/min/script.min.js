/*! idea - v0.1.0 - 2018-03-22 */"use strict";function mapInit(){var a=new ymaps.Map("map",{center:[53.894617,30.331014],zoom:11,controls:["zoomControl","fullscreenControl"]});addMapClickEvent(a)}function mapInitIdeaDetails(a){var b=new ymaps.Map("map",{center:[53.894617,30.331014],zoom:11,controls:["zoomControl","fullscreenControl"]});if(a&&a.latitude&&a.longitude){var c=new ymaps.Placemark([a.latitude,a.longitude],null,{preset:"islands#redIcon"});b.geoObjects.add(c)}addMapClickEvent(b)}function addMapClickEvent(a){a.events.add("click",function(b){var c=b.get("coords");a.geoObjects.removeAll();var d=new ymaps.Placemark([c[0],c[1]],null,{preset:"islands#redIcon"});a.geoObjects.add(d)})}angular.module("ideaApp",["ngResource","ui.router","ui.bootstrap","ngCookies","angular-md5","app.directives","app.services","app.filters","ideaFactories","app.controllers","yaMap","ngImgur","ngFileUpload","ngMessages","pascalprecht.translate","ngSanitize"]),angular.module("app.directives",[]),angular.module("app.services",[]),angular.module("app.controllers",[]),angular.module("app.filters",[]),angular.module("ideaFactories",["ngResource"]),function(){function a(a,b,c,d){b.otherwise("/home"),a.state("root",{abstract:!0}).state("home",{url:"/home",views:{"main@":{templateUrl:"pages/app.html",controller:"ideasCtrl as ideasCtrl"}},parent:"root"}).state("login",{url:"/login",views:{"main@":{templateUrl:"pages/login.html"}},parent:"root"}).state("register",{url:"/register",views:{"main@":{templateUrl:"pages/registration.html"}},parent:"root"}).state("myIdeas",{url:"/myideas",views:{"main@":{templateUrl:"pages/app.html",controller:"ideasCtrl as ideasCtrl"}},parent:"root"}).state("ideaDetails",{url:"/ideaDetails:idea",views:{"main@":{templateUrl:"pages/details.html",controller:"detailsCtrl as detailsCtrl",resolve:{ideaDetails:["$stateParams",function(a){var b=angular.fromJson(a.idea);return b}]}}},parent:"root"}).state("ideaAddNew",{url:"/ideaAddNew",views:{"main@":{templateUrl:"pages/createUpdateIdea.html",controller:"addNewIdea as ctrl"}},parent:"root"}).state("accessDenied",{url:"/accessDenied",views:{"main@":{templateUrl:"pages/accessDenied.html",controller:"accessDenied as ctrl"}},parent:"root"}).state("ideaUpdate",{url:"/ideaUpdate:idea",views:{"main@":{templateUrl:"pages/createUpdateIdea.html",controller:"updateIdea as ctrl",resolve:{ideaDetails:["$stateParams",function(a){var b=angular.fromJson(a.idea);return b}]}}},parent:"root"}).state("profile",{url:"/account",views:{"main@":{templateUrl:"pages/profile.html",controller:"profileCtrl as ctrl"}},parent:"root"}),d.useStaticFilesLoader({prefix:"languages/",suffix:".json"}),d.useSanitizeValueStrategy("sanitize"),d.preferredLanguage("ru")}function b(a,b,e,f,g,h){function i(){a.previousPage,a.$on("$locationChangeStart",function(f,g,h){var i;if(a.previousPage=d(h),a.authenticated===!1)i=$.inArrayRegEx(b.path(),["/login","/register","/home","/ideaDetails","^$"])===-1,i&&(a.previousPage=d(g),b.path("/login"));else if(i=$.inArrayRegEx(b.path(),["/ideaUpdate"])!==-1){var j=c(b.path());e.redirectFromEditToAccessDeniedIfNeeded(j)}else i=$.inArray(b.path(),["/login"])!==-1,i&&b.path("/home")})}f.init(),h.init().then(function(){i()})}function c(a){var b=a.substring(a.indexOf("{"),a.indexOf("}")+1);return angular.fromJson(b)}function d(a){var b=a.substring(a.indexOf("#")+1);return b}angular.module("ideaApp").config(a).run(b),a.$inject=["$stateProvider","$urlRouterProvider","$httpProvider","$translateProvider"],b.$inject=["$rootScope","$location","authorizationService","stateService","$q","authentificationService"],$.inArrayRegEx=function(a,b){for(var c=0;c<b.length;c++)if(RegExp(b[c]).test(a))return c;return-1}}(),function(){function a(){return{scope:{targetModel:"=compareTo"},require:"ngModel",link:function(a,b,c,d){var e=function(){var c=b.val(),d=a.targetModel;return null!==d&&c===d};a.$watch(e,function(a){d.$setValidity("errorCompareTo",a)})}}}angular.module("app.directives").directive("compareTo",a)}(),function(){function a(){return{restrict:"A",require:"ngModel",priority:1,link:function(a,b,c,d){"radio"!==c.type&&"checkbox"!==c.type&&(b.unbind("input").unbind("keydown").unbind("change"),b.bind("blur",function(){a.$apply(function(){d.$setViewValue(b.val())})}))}}}angular.module("app.directives").directive("ngModelOnblur",a)}(),function(){function a(a,b){return{require:"ngModel",link:function(a,c,d,e){function f(a){e.$setValidity("recordLoading",!a)}function g(a){e.$setValidity("recordAvailable",!a)}c.bind("click",function(){f(!1),g(!1)}),c.bind("blur",function(){a.$apply(function(){c.val()&&0!=c.val().length&&(f(!0),g(!1),b.getOneRegisteredByEmail(c.val()).then(function(a){f(!1),g(!0)},function(a){f(!1),g(!1)}))})})}}}angular.module("app.directives").directive("recordAvailabilityValidator",a),a.$inject=["$http","usersFactory"]}(),function(){function a(a,b,c,d){function e(){var e=d.defer();return b.get("user",{headers:c}).success(function(b){b.name?(a.authenticated=!0,a.currentUser=b):a.authenticated=!1,e.resolve()}).error(function(){a.authenticated=!1,e.resolve()}),e.promise}function f(c,d){var e=c?{authorization:"Basic "+btoa(c.email+":"+c.password)}:{};b.get("user",{headers:e}).success(function(b){b.name?(a.authenticated=!0,a.currentUser=b):a.authenticated=!1,d&&d()}).error(function(){a.authenticated=!1,d&&d()})}var g={init:e,authenticate:f};return g}angular.module("app.services").service("authentificationService",a),a.$inject=["$rootScope","$http","$cookies","$q"]}(),function(){function a(a,b,c,d,e,f){function g(){f.authenticate(h.credentials,function(){d.authenticated?(c.path(d.previousPage),h.error=!1):(c.path("login"),h.error=!0)})}var h=this;h.login=g,h.credentials={}}angular.module("app.controllers").controller("LoginController",a),a.$inject=["$scope","$http","$location","$rootScope","$cookies","authentificationService"]}(),function(){function a(a,b,c,d,e){function f(){var a={username:h.credentials.username,email:h.credentials.email,password:h.credentials.password};h.registrationRequest(a)}function g(a){e.createUser(a).then(function(a){c.location.href="#home",c.location.reload()},function(a){alert("Ошибка создания пользователя: "+a.statusText)})}var h=this;h.registrationRequest=g,h.registration=f,h.credentials={}}angular.module("app.controllers").controller("RegistrationController",a),a.$inject=["$scope","$http","$window","$rootScope","usersFactory"]}(),function(){function a(a,b){a.back=function(){b.location.href="#home"}}angular.module("app.controllers").controller("accessDenied",a),a.$inject=["$scope","$window"]}(),function(){function a(a,b,c,d){function e(e){a.hasRole("ROLE_ADMIN")||b.getIdeaById(e.id).then(function(a){b.isUserAuthorOfIdea(c.currentUser,a)||d.path("/accessDenied")})}var f={redirectFromEditToAccessDeniedIfNeeded:e};return f}angular.module("app.services").service("authorizationService",a),a.$inject=["sessionService","ideasFactory","$rootScope","$location"]}(),function(){function a(a){function b(b){var c=a.ideas().createComment({id:b.subject.id},b).$promise;return c}function c(b,c){var d=a.ideas().getCommentsPage({id:c,page:b.page,size:b.size,sort:b.sort}).$promise;return d}function d(b){var c=a.comments().changeLike({id:b}).$promise;return c}var e={createComment:b,getCommentsPageByIdeaId:c,changeCommentLike:d};return e}angular.module("ideaFactories").factory("commentsFactory",a),a.$inject=["restFactory"]}(),function(){function a(a,b){return{restrict:"A",replace:!1,scope:{comment:"=",changeLike:"&",isAuthenticated:"="},link:function(c,d,e){c.photo=c.comment.author.imageUrl?c.comment.author.imageUrl:"images/no_user_photo.png",c.likedUsersList=a.getlikedUsersListAsString(c.comment),c.changeLike=function(){b.changeCommentLike(c.comment.id).then(function(b){c.comment.rating=b.rating,c.comment.liked=!c.comment.liked,c.likedUsersList=a.getlikedUsersListAsString(b)})}},templateUrl:"templates/comment.tpl.html"}}angular.module("app.directives").directive("showComment",a),a.$inject=["usersService","commentsFactory"]}(),function(){function a(a){return function(b,c){return c&&(b=b.replace(new RegExp("("+c+")","gi"),'<span class="highlight">$1</span>')),a.trustAsHtml(b)}}angular.module("app.filters").filter("highlightTextInDescriptionOfIdea",["$sce",a])}(),function(){function a(){return function(a,b){var c=[];if(b&&0!==b.length)if("@"==b.charAt(0)||"#"==b.charAt(0)){var d=b.substring(1);if(d.length>0)for(var e=0;e<a.length;e++){var f=a[e];if(f.tags)for(var g=0;g<f.tags.length;g++){var h=f.tags[g];if(h.name.indexOf(d)>=0){c.push(f);break}}}else c=a.slice()}else for(var e=0;e<a.length;e++){var f=a[e];(f.title.indexOf(b)>=0||f.description.indexOf(b)>=0)&&c.push(f)}else a&&(c=a.slice());return c}}angular.module("app.filters").filter("searchLineFilter",a)}(),function(){function a(a,b,c){return{restrict:"A",scope:{content:"@",container:"@"},controller:["$scope","$element",function(a,b){a.attachEvents=function(a){$(".popover").on("mouseenter",function(){c.insidePopover=!0}),$(".popover").on("mouseleave",function(){c.insidePopover=!1,$(a).popover("hide")})}}],link:function(a,d,e){a.$watch(function(){return a.content},function(){c.insidePopover=!1;$(d).popover({placement:"top",container:a.container});$(d).data("bs.popover").options.content=a.content,$(d).bind("mouseenter",function(e){b(function(){c.insidePopover||($(d).popover("show"),a.attachEvents(d))},50)}),$(d).bind("mouseleave",function(a){b(function(){c.insidePopover||$(d).popover("hide")},50)})})}}}angular.module("app.directives").directive("hoverPopover",a),a.$inject=["$compile","$timeout","$rootScope"]}(),function(){function a(a,b,c,d,e,f,g,h){this.categories=d.getCategories(),a.bottomButtonName="ADD",a.data=null,a.submitted=!1,a.imageExist=!1,a.imageFile,a.imageUrl="images/photo.gif",a.modalInstance=null,a.files=null,a.windowTitle="ADD_IDEA",a.center=[30.331014,53.894617];var i=null,j=null;a.back=function(){b.location.href="#home"},a.openModalWindowLoadingProgress=function(){a.modalInstance=c.open({animation:!0,templateUrl:"myModalContent.html",size:"lg"})},a.closeModalWindow=function(){a.modalInstance.close(),a.modalInstance=null},a.$watch("files",function(){a.files&&a.files.length&&(a.openModalWindow(),a.load2Imgur(a.files))}),a.chooseFile=function(){$("input[type=file]").click(),$("input[type=file]").change(function(){var b=document.getElementById("imageLoader");b&&b.files&&b.files[0]&&(a.imageFile=b.files[0],a.openModalWindowLoadingProgress(),a.load2Imgur(a.imageFile))})},a.load2Imgur=function(b){g.setAPIKey("Client-ID c62cfae02efe4c0"),g.upload(b).then(function(b){Object.getPrototypeOf(b)===Object.prototype?a.imageUrl=b.link:a.imageUrl=b[0].link,a.imageExist=!0,a.closeModalWindow()})},a.doWork=function(b){if(a.submitted=!0,!a.ideaForm.$invalid){for(var c=new Array,d=0;d<1;d++)null!=c[d]&&void 0!=c[d]&&c.push({id:d,name:b.tagName});var e={id:null,description:b.description,title:b.title,createdAt:(new Date).getTime(),lastModifiedAt:(new Date).getTime(),tags:c,latitude:j?j[1]:0,longitude:j?j[0]:0};1==a.imageExist&&(e.imageUrl=a.imageUrl),a.insertIdea(e)}},a.insertIdea=function(a){e.insertIdea(a).then(function(a){b.location.href="#home"},function(a){alert("Ошибка создания идеии: "+a.statusText)})},a.beforeInit=function(){var a=ymaps.geolocation;j=[a.longitude,a.latitude]},a.afterInit=function(a){i=a,j&&f.setGeoCoordsDirective(i,j)},a.mapClick=function(a){var b=a.get("coords");j=b;var c={latitude:b[1],longitude:b[0]};f.setGeoCoordsDirective(i,c)}}angular.module("app.controllers").controller("addNewIdea",a),a.$inject=["$scope","$window","$modal","detailsService","ideasFactory","mapGeoService","imgur","Upload"]}(),function(){function a(a,b,c,d,e,f,g,h,i,j){a.modalInstance=null,a.ideaDetails=g,a.likedUsersList=null,a.idea=null,a.myMap=null,a.commentBody=null;var k=this;k.comments=null,k.paramsForComments={page:0,size:10,sort:"creationTime,desc"},a.loadModalLargeMap=function(){a.modalInstance=c.open({animation:!0,templateUrl:"pages/public/largeMap.html",controller:"modalLargeMap",resolve:{geo:function(){return a.geoPoints}}})},this.loadPageForComments=function(){k.paramsForComments.page++;var b=j.getCommentsPageByIdeaId(k.paramsForComments,a.ideaDetails.id);return b.then(function(a){a&&(k.comments=k.comments.concat(a))}),b},a.isAuthor=function(a){return f.isUserAuthorOfIdea(e.currentUser,a)},this.promises=f.getIdeaById(a.ideaDetails.id).then(function(b){a.idea=b,null!=a.idea&&(a.likedUsersList=i.getlikedUsersListAsString(a.idea)),a.idea&&a.idea.latitude&&a.idea.longitude&&(a.geoPoints={latitude:a.idea.latitude,longitude:a.idea.longitude},h.setGeoCoordsSimpleMap(a.myMap,a.geoPoints)),null!=a.idea&&null==a.idea.imageUrl&&(a.idea.imageUrl="images/300x300.png")}),j.getCommentsPageByIdeaId(k.paramsForComments,a.ideaDetails.id).then(function(a){k.comments=a}),a.edit=function(){d.go("ideaUpdate",{idea:angular.toJson(a.ideaDetails)})},a.remove=function(){f.removeIdea(a.ideaDetails).then(function(a){alert("Удалено"),d.go("home")})},a.changeMapVisibility=function(){$("#map").toggle()},a.changeLike=function(){f.changeIdeaLike(a.ideaDetails.id).then(function(b){a.idea.rating=b.rating,a.idea.liked=!a.idea.liked,a.likedUsersList=i.getlikedUsersListAsString(b)})},a.init=function(){a.myMap=new ymaps.Map("map",{center:h.getMapCenter(),zoom:11})},a.addComment=function(){var b={id:null,body:a.commentBody,subject:{id:a.ideaDetails.id}};j.createComment(b).then(function(b){k.comments.unshift(b),a.commentBody=null})},a.cancelAddComment=function(){a.commentBody=null}}angular.module("app.controllers").controller("detailsCtrl",a),a.$inject=["$scope","$window","$modal","$state","$rootScope","ideasFactory","ideaDetails","mapGeoService","usersService","commentsFactory"]}(),function(){function a(a,b,c,d,e,f,g,h,i){a.states=e.getIdeaStates(),a.bottomButtonName="UPDATE",a.idea=f,a.data=null,a.data,a.imageExist=!1,a.imageFile,a.imageUrl=null,a.modalInstance=null,a.files=null,a.windowTitle="CHANGE_IDEA",a.isUpdating=!0,a.center=[30.331014,53.894617];var j=null,k=null;a.openModalWindow=function(){a.modalInstance=c.open({animation:!0,templateUrl:"myModalContent.html",size:"lg"})},a.closeModalWindow=function(){a.modalInstance.close(),a.modalInstance=null},a.$watch("files",function(){a.files&&a.files.length&&(a.openModalWindow(),a.load2Imgur(a.files))}),a.chooseFile=function(){$("input[type=file]").click(),$("input[type=file]").change(function(){var b=document.getElementById("imageLoader");b&&b.files&&b.files[0]&&(a.imageFile=b.files[0],a.openModalWindow(),a.load2Imgur(a.imageFile))})},a.load2Imgur=function(b){h.setAPIKey("Client-ID c62cfae02efe4c0"),h.upload(b).then(function(b){Object.getPrototypeOf(b)===Object.prototype?a.imageUrl=b.link:a.imageUrl=b[0].link,a.imageExist=!0,a.closeModalWindow()})},this.promises=d.getIdeaById(a.idea.id).then(function(b){if(a.data=b,a.data&&a.data.latitude&&a.data.longitude&&j){var c={latitude:a.data.latitude,longitude:a.data.longitude};a.imageUrl=a.data.imageUrl,g.setGeoCoordsDirective(j,c)}}),a.back=function(){b.location.href="#home"},a.doWork=function(c){if(!a.ideaForm.$invalid){for(var e=d.getIdeaById(c.id),f=new Array,g=0;g<1;g++)f.push({id:g,name:c.tagName});var h={id:c.id,description:c.description,title:c.title,rating:e.rating,createdAt:e.createdAt,lastModifiedAt:(new Date).getTime(),links:c.links,tags:f,author:e.author,latitude:k?k[1]:0,longitude:k?k[0]:0,state:c.state};1==a.imageExist&&(h.imageUrl=a.imageUrl),d.updateIdea(h).then(function(a){b.location.href="#home"},function(a){alert("Ошибка обновления идеии: "+a.statusText)})}},a.afterInit=function(a){j=a},a.mapClick=function(a){var b=a.get("coords");k=b,j.balloon.open(b,"Моя идея")}}angular.module("app.controllers").controller("updateIdea",a),a.$inject=["$scope","$window","$modal","ideasFactory","stateService","ideaDetails","mapGeoService","imgur","Upload"]}(),function(){function a(a,b,c,d,e,f){function g(){var a=!1;return b.path().indexOf("/myideas")!==-1&&(a=!0),a}function h(){g()&&(l.tabAll="TAB_ALL_MY")}function i(){g()?l.userId=c.currentUser.id:l.userId=null,j(l.popular),j(l.latest),l.query=null,h(),c.$broadcast("query-clean")}function j(b,c){return d.getPage(b.params,l.userId,l.tag,l.query).then(function(d){d&&c?b.list=b.list.concat(d):b.list=d,a.geoObjects=f.generateGeoObjects(b.list)})}var k,l=this;l.userId=null,l.tabAll="TAB_ALL",l.query=null,l.tag=null,l.popular={list:[],params:{page:0,size:5,sort:"rating,desc"}},l.latest={list:[],params:{page:0,size:5,sort:"creationTime,desc"}},a.geoObjects=null,a.criteria=null,a.mapCenter=f.getMapCenter(),a.mapZoom=f.getMapDefaultZoom(),a.afterMapInit=function(a){k=a},a.$on("query-update",function(a,b){l.query=b,l.selectByQuery()}),a.mouseenter=function(a){a.get("target").options.set("preset","islands#greenIcon")},a.mouseleave=function(a){a.get("target").options.unset("preset")},l.update=function(a){return a.params.page++,j(a,!0)},l.selectByCategory=function(a){l.tag=a,l.popular.params.page=0,l.latest.params.page=0,j(l.popular),j(l.latest)},l.selectByQuery=function(){l.popular.params.page=0,l.latest.params.page=0,j(l.popular),j(l.latest)},l.details=function(a){var b={id:a.id};console.log("Go to Details"),$state.go("ideaDetails",{idea:angular.toJson(b)})},i()}angular.module("app.controllers").controller("ideasCtrl",a),a.$inject=["$scope","$location","$rootScope","ideasFactory","tagsFactory","mapGeoService"]}(),function(){function a(a){function b(a,b){return!(!b||!a||a.id!=b.author.id)}function c(){var b=a.ideas().get().$promise;return b}function d(b){var c=a.ideas().show({id:b}).$promise;return c}function e(b){var c=a.ideas().update({id:b.id},b).$promise;return c}function f(b){var c=a.ideas().create(b).$promise;return c}function g(b){var c=a.ideas().delete(b).$promise;return c}function h(b){var c=a.ideas().changeLike({id:b}).$promise;return c}function i(b,c,d,e){var f=a.ideas().getPage({userId:c,page:b.page,size:b.size,sort:b.sort,tagId:null!=d?d.id:null,query:e}).$promise;return f}var j={getIdeas:c,getIdeaById:d,insertIdea:f,updateIdea:e,removeIdea:g,changeIdeaLike:h,getPage:i,isUserAuthorOfIdea:b};return j}angular.module("ideaFactories").factory("ideasFactory",a),a.$inject=["restFactory"]}(),function(){function a(a,b,c){var d=this;b.query=null,d.changeQuery=function(){a.$broadcast("query-update",b.query)},d.isSearchVisible=function(){return c.path().indexOf("/myideas")!==-1||c.path().indexOf("/home")!==-1},b.$on("query-clean",function(){b.query=null})}angular.module("app.controllers").controller("ideasSearchCtrl",a),a.$inject=["$rootScope","$scope","$location"]}(),function(){function a(a){var b=a.instant("MY_IDEA"),c=a.instant("IDEA");return{setGeoCoordsDirective:function(a,c){if(c){var c=[c.longitude,c.latitude];a.balloon.open(c,b)}},setGeoCoordsSimpleMap:function(a,b){if(b){var c=new ymaps.Placemark([b.longitude,b.latitude],null,{preset:"islands#greenStretchyIcon"});a.geoObjects.add(c)}},generateGeoObjects:function(a){var b=new Array;if(a)for(var d=0;d<a.length;d++){var e=a[d];if(e&&e.longitude&&e.latitude){var f={geometry:{type:"Point",coordinates:[e.longitude,e.latitude]},properties:{balloonContent:e.title,clusterCaption:c+" #"+e.id}};b.push(f)}}return b},getMapCenter:function(){return[30.331014,53.894617]},getMapDefaultZoom:function(){return 11}}}angular.module("app.services").service("mapGeoService",a),a.$inject=["$translate"]}(),function(){function a(a,b,c,d,e){a.mapModal=null,a.close=function(){c.close()},a.initModal=function(){a.mapModal=new ymaps.Map("mapModal",{center:d.getMapCenter(),zoom:11}),d.setGeoCoordsSimpleMap(a.mapModal,e)}}angular.module("app.controllers").controller("modalLargeMap",a),a.$inject=["$scope","$rootScope","$modalInstance","mapGeoService","geo"]}(),function(){function a(a,b){return{restrict:"E",replace:!0,scope:{photo:"@",idea:"=",ngModel:"=",details:"&",changeRating:"&",changeLike:"&",isAuthenticated:"="},link:function(c,d,e){c.photo=c.idea.imageUrl?c.idea.imageUrl:"images/photo.gif",c.details=function(){var a={id:c.idea.id};b.go("ideaDetails",{idea:angular.toJson(a)})},c.changeRating=function(b){c.idea.rating+=b,a.updateIdea(c.idea)},c.changeLike=function(){a.changeIdeaLike(c.idea.id).then(function(a){c.idea.rating=a.rating}),c.idea.liked=!c.idea.liked}},templateUrl:"templates/idea.tpl.html"}}angular.module("app.directives").directive("showIdea",a),a.$inject=["ideasFactory","$state"]}(),function(){function a(a){return{restrict:"A",replace:!0,compile:function(b,c){return b.attr("ng-class","{'label label-success' : idea.state.name == 'New', 'label label-warning' : idea.state.name == 'Assigned', 'label label-danger' : idea.state.name == 'Deleted', 'label label-info' : idea.state.name == 'InProgress'}"),b.removeAttr("idea-state-label"),{pre:function(a,b,c,d){},post:function(b,c,d,e){a(c)(b)}}}}}angular.module("app.directives").directive("ideaStateLabel",a),a.$inject=["$compile"]}(),function(){function a(){return{restrict:"E",replace:!0,templateUrl:"templates/ideaStateUpdate.tpl.html"}}angular.module("app.directives").directive("showIdeaStateUpdate",a)}(),function(){function a(a){var b=null,c=a.get("api/v1/states/").success(function(a){b=a});return{getIdeaStates:function(){return b},init:function(){return c}}}angular.module("app.services").service("stateService",a),a.$inject=["$http"]}(),function(){function a(a){function b(){return a("api/v1/tags/",{},{get:{method:"GET",isArray:!0},getIdeasByTag:{method:"GET",params:{id:"@id"},url:"api/v1/tags/:id/ideas/",isArray:!0}})}function c(){return a("api/v1/ideas/",{},{get:{method:"GET",isArray:!0},show:{method:"GET",params:{ideaId:"@id"},url:"api/v1/ideas/:id/"},update:{method:"PUT",params:{id:"@id"},url:"api/v1/ideas/:id/"},create:{method:"POST",url:"api/v1/ideas/"},delete:{method:"DELETE",url:"api/v1/ideas/:id/"},changeLike:{method:"POST",params:{id:"@id"},url:"api/v1/ideas/:id/like/"},createComment:{method:"POST",params:{id:"@id"},url:"api/v1/ideas/:id/comments/"},getCommentsPage:{method:"GET",params:{id:"@id",page:"@page",size:"@size",sort:"@sort"},url:"api/v1/ideas/:id/comments?page=:page&size=:size&sort=:sort",isArray:!0},getPage:{method:"GET",params:{userId:"@userId",page:"@page",size:"@size",sort:"@sort",tagId:"@tagId",query:"@query"},url:"api/v1/ideas?page=:page&size=:size&sort=:sort&sort=title,asc&userId=:userId&tagId=:tagId&query=:query",isArray:!0}})}function d(){return a("api/v1/users/",{},{get:{method:"GET",isArray:!0},getOne:{method:"GET",params:{id:"@id"},url:"api/v1/users/:id/"},create:{method:"POST",url:"user/register/"},getOneRegisteredByEmail:{method:"GET",params:{email:"@email"},url:"api/v1/users/:email/email"},update:{method:"PUT",params:{id:"@id"},url:"api/v1/users/:id/"}})}function e(){return a("api/v1/comments/",{},{changeLike:{method:"POST",params:{id:"@id"},url:"api/v1/comments/:id/like/"}})}var f={ideas:c,tags:b,users:d,comments:e};return f}angular.module("ideaFactories").factory("restFactory",a),a.$inject=["$resource"]}(),function(){function a(){return{restrict:"A",scope:{updateFunction:"&"},link:function(a,b,c){var d=function(){var c=$(b);c&&c[0].scrollHeight-c.scrollTop()==c.outerHeight()&&(b.unbind("scroll"),a.updateFunction().then(function(){b.bind("scroll",d)}))};b.bind("scroll",d)}}}angular.module("app.directives").directive("scrollableList",a),a.$inject=[]}(),function(){function a(){return{getCategories:function(){return[{id:0,descr:"Sport"},{id:1,descr:"Transport"},{id:2,descr:"Культура"}]}}}angular.module("app.services").service("detailsService",a)}(),function(){function a(a){function b(b){var c=a.users().createSession(b).$promise;return c}function c(b){var c=a.users().deleteSession({sessionId:b}).$promise;return c}function d(b){var c=a.users().getSession({sessionId:b}).$promise;return c}var e={createSession:b,deleteSession:c,getSession:d};return e}angular.module("ideaFactories").factory("sessionFactory",a),a.$inject=["restFactory"]}(),function(){function a(a,b,c,d,e,f){var g=this;g.logout=e.logout,g.useLang=function(a){d.use(a)},g.getCurrentLang=function(){return d.use()},g.hasRole=function(a,b){return e.hasRole(a,b)},g.getIconClassForCurrentUser=function(){var b=a.currentUser;return e.getIconClassForCurrentUser(b)}}angular.module("app.controllers").controller("sessionCtrl",a),a.$inject=["$rootScope","$http","$location","$translate","sessionService","authentificationService"]}(),function(){function a(a,b,c){function d(){b.post("logout",{}).success(function(){a.authenticated=!1,a.currentUser={},c.path("/home")}).error(function(a){})}function e(){return""!=k&&null!=k||(k=localStorage.getItem("SessionId")),k}function f(a){localStorage.setItem("SessionId",a),k=a}function g(){return""!=l&&null!=l||(l=localStorage.getItem("user")),l}function h(a){localStorage.setItem("user",a),l=a}function i(b,c){if(void 0==c){if(void 0==a.currentUser)return!1;c=a.currentUser}for(var d=0;d<c.authorities.length;d++)return c.authorities[d].authority==b}function j(a){return"GOOGLE"===a.socialSignInProvider?"fa fa-google-plus-square color-google-plus":"FACEBOOK"===a.socialSignInProvider?"fa fa-facebook-square color-facebook":"VKONTAKTE"===a.socialSignInProvider?"fa fa-vk color-vk":"fa fa-user"}var k="",l={},m={getSessionId:e,setSessionId:f,getUser:g,setUser:h,hasRole:i,getIconClassForCurrentUser:j,logout:d};return m}angular.module("app.services").service("sessionService",a),a.$inject=["$rootScope","$http","$location"]}(),function(){function a(){return{restrict:"E",replace:!0,transclude:!0,scope:{active:"=",click:"&",identifier:"@"},link:function(a,b,c){function d(a){return angular.element($("#tag-buttons").find(a)[0])}1==a.active&&b.addClass("active"),b.bind("click",function(){d(".active").removeClass("active"),b.addClass("active"),a.$apply(function(){a.click({tag:b.text()})})})},template:['<a id="{{identifier}}" type="button" class="btn btn-default" ng-transclude></a>'].join("")}}angular.module("app.directives").directive("tagButton",a)}(),function(){function a(a,b){var c=this;b.getTopNTags().then(function(a){c.tagsTop=a}),a.$on("topTags-update",function(){b.getTopNTags().then(function(a){c.tagsTop=a})})}angular.module("app.controllers").controller("tagsCtrl",a),a.$inject=["$scope","tagsFactory"]}(),function(){function a(a){function b(){var b=a.tags().get().$promise;return b}function c(b){var c;return c=void 0===b?a.ideas().get().$promise:a.tags().getIdeasByTag({id:b}).$promise}var d={getTopNTags:b,getIdeasByTag:c};return d}angular.module("ideaFactories").factory("tagsFactory",a),a.$inject=["restFactory"]}(),function(){function a(a,b,c,d,e){var f=a.currentUser.imageUrl?a.currentUser.imageUrl:"images/logo.png";a.profile={id:a.currentUser.id,username:a.currentUser.username,email:a.currentUser.email,password:a.currentUser.password,imageUrl:f},a.back=function(){b.location.href="#home"},a.doWork=function(b){if(!a.profileForm.$invalid){var c={id:b.id,email:b.email,password:b.password};d.updateUser(c).then(function(a){e.logout()},function(a){alert("Ошибка обновления профайла пользователя: "+a.statusText)})}}}angular.module("app.controllers").controller("profileCtrl",a),a.$inject=["$scope","$window","$modal","usersFactory","sessionService"]}(),function(){function a(a){function b(){a.ideas().get().$promise}function c(b){a.ideas().getOne({id:b}).$promise}function d(b){var c=a.users().create(b).$promise;return c}function e(b){var c=a.users().getOneRegisteredByEmail({email:b}).$promise;return c}function f(b){var c=a.users().update(b).$promise;return c}var g={get:b,getOne:c,createUser:d,getOneRegisteredByEmail:e,updateUser:f};return g}angular.module("ideaFactories").factory("usersFactory",a),a.$inject=["restFactory"]}(),function(){function a(){function a(a){for(var b=[],c=0;c<a.likedUsers.length;c++)b.push(a.likedUsers[c].username);return b.join(", ")}var b={getlikedUsersListAsString:a};return b}angular.module("app.services").service("usersService",a)}();